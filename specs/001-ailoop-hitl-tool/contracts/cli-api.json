{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "ailoop-cli-api",
  "title": "ailoop CLI Command Contract",
  "description": "Command-line interface contract for ailoop human-in-the-loop tool",
  "version": "1.0.0",

  "commands": {
    "ask": {
      "description": "Ask a question and collect human response",
      "usage": "ailoop ask [OPTIONS] <QUESTION>",
      "arguments": {
        "QUESTION": {
          "type": "string",
          "description": "Question text to present to human user",
          "required": true,
          "validation": {
            "min_length": 1,
            "max_length": 1000
          }
        }
      },
      "options": {
        "channel": {
          "type": "string",
          "short": "c",
          "long": "channel",
          "description": "Channel name for message routing",
          "default": "public",
          "validation": {
            "pattern": "^[a-z0-9][a-z0-9_-]{0,63}$"
          }
        },
        "timeout": {
          "type": "integer",
          "short": "t",
          "long": "timeout",
          "description": "Response timeout in seconds",
          "default": 0,
          "validation": {
            "minimum": 0,
            "maximum": 3600
          }
        },
        "server": {
          "type": "string",
          "short": "s",
          "long": "server",
          "description": "Server URL for remote operation",
          "default": "http://127.0.0.1:8080",
          "validation": {
            "format": "uri"
          }
        },
        "json": {
          "type": "boolean",
          "long": "json",
          "description": "Output response in JSON format",
          "default": false
        }
      },
      "exit_codes": {
        "0": "Success - response received",
        "1": "Error - timeout exceeded",
        "2": "Error - user cancelled",
        "3": "Error - server unavailable",
        "4": "Error - invalid arguments"
      },
      "output_formats": {
        "text": "Plain text response",
        "json": {
          "type": "object",
          "properties": {
            "response": {"type": "string"},
            "timestamp": {"type": "string", "format": "date-time"},
            "channel": {"type": "string"}
          }
        }
      }
    },

    "authorize": {
      "description": "Request authorization for a critical action",
      "usage": "ailoop authorize [OPTIONS] <ACTION>",
      "arguments": {
        "ACTION": {
          "type": "string",
          "description": "Description of action requiring authorization",
          "required": true,
          "validation": {
            "min_length": 1,
            "max_length": 500
          }
        }
      },
      "options": {
        "channel": {
          "type": "string",
          "short": "c",
          "long": "channel",
          "description": "Channel name for message routing",
          "default": "public"
        },
        "timeout": {
          "type": "integer",
          "short": "t",
          "long": "timeout",
          "description": "Authorization timeout in seconds",
          "default": 300
        },
        "server": {
          "type": "string",
          "short": "s",
          "long": "server",
          "description": "Server URL for remote operation",
          "default": "http://127.0.0.1:8080"
        },
        "json": {
          "type": "boolean",
          "long": "json",
          "description": "Output decision in JSON format",
          "default": false
        }
      },
      "exit_codes": {
        "0": "Success - authorization granted",
        "1": "Error - authorization denied",
        "2": "Error - timeout exceeded",
        "3": "Error - server unavailable",
        "4": "Error - invalid arguments"
      },
      "output_formats": {
        "text": "'authorized' or 'denied'",
        "json": {
          "type": "object",
          "properties": {
            "authorized": {"type": "boolean"},
            "action": {"type": "string"},
            "timestamp": {"type": "string", "format": "date-time"},
            "channel": {"type": "string"}
          }
        }
      }
    },

    "say": {
      "description": "Send a notification message to human users",
      "usage": "ailoop say [OPTIONS] <MESSAGE>",
      "arguments": {
        "MESSAGE": {
          "type": "string",
          "description": "Notification message text",
          "required": true,
          "validation": {
            "min_length": 1,
            "max_length": 1000
          }
        }
      },
      "options": {
        "channel": {
          "type": "string",
          "short": "c",
          "long": "channel",
          "description": "Channel name for message routing",
          "default": "public"
        },
        "priority": {
          "type": "string",
          "short": "p",
          "long": "priority",
          "description": "Message priority level",
          "default": "normal",
          "enum": ["low", "normal", "high", "urgent"]
        },
        "server": {
          "type": "string",
          "short": "s",
          "long": "server",
          "description": "Server URL for remote operation",
          "default": "http://127.0.0.1:8080"
        }
      },
      "exit_codes": {
        "0": "Success - message delivered",
        "1": "Error - server unavailable",
        "2": "Error - invalid arguments"
      },
      "output": "No output on success"
    },

    "serve": {
      "description": "Start ailoop server for multi-agent communication",
      "usage": "ailoop serve [OPTIONS]",
      "arguments": {},
      "options": {
        "host": {
          "type": "string",
          "short": "h",
          "long": "host",
          "description": "Server bind address",
          "default": "127.0.0.1"
        },
        "port": {
          "type": "integer",
          "short": "p",
          "long": "port",
          "description": "Server port number",
          "default": 8080,
          "validation": {
            "minimum": 1024,
            "maximum": 65535
          }
        },
        "channel": {
          "type": "string",
          "short": "c",
          "long": "channel",
          "description": "Default channel name",
          "default": "public"
        }
      },
      "exit_codes": {
        "0": "Success - server started and running",
        "1": "Error - port already in use",
        "2": "Error - permission denied",
        "3": "Error - invalid arguments"
      },
      "behavior": {
        "terminal_ui": "Displays interactive interface with queue status",
        "message_queuing": "Queues incoming messages when no humans connected",
        "cleanup": "Automatically cleans up inactive channels and connections",
        "shutdown": "Graceful shutdown on SIGINT/SIGTERM"
      }
    },

    "config": {
      "description": "Configure ailoop settings interactively",
      "usage": "ailoop config --init [OPTIONS]",
      "arguments": {},
      "options": {
        "init": {
          "type": "boolean",
          "long": "init",
          "description": "Start interactive configuration setup",
          "required": true
        },
        "config-file": {
          "type": "string",
          "long": "config-file",
          "description": "Path to configuration file",
          "default": "~/.config/ailoop/config.toml"
        }
      },
      "exit_codes": {
        "0": "Success - configuration created",
        "1": "Error - validation failed",
        "2": "Error - file system error",
        "3": "Error - user cancelled"
      },
      "configuration_schema": {
        "timeout_seconds": {"type": "integer", "minimum": 0, "maximum": 3600},
        "default_channel": {"type": "string", "pattern": "^[a-z0-9][a-z0-9_-]{0,63}$"},
        "log_level": {"type": "string", "enum": ["error", "warn", "info", "debug", "trace"]},
        "server_host": {"type": "string"},
        "server_port": {"type": "integer", "minimum": 1024, "maximum": 65535}
      }
    }
  },

  "global_options": {
    "help": {
      "short": "h",
      "long": "help",
      "description": "Display help information"
    },
    "version": {
      "short": "V",
      "long": "version",
      "description": "Display version information"
    },
    "verbose": {
      "short": "v",
      "long": "verbose",
      "description": "Enable verbose output"
    }
  },

  "error_handling": {
    "validation_errors": "Display specific validation error messages",
    "network_errors": "Provide clear connection failure reasons",
    "permission_errors": "Explain required permissions and access levels",
    "timeout_errors": "Include timeout duration and configured limits",
    "user_friendly": "All error messages designed for non-technical users"
  },

  "compatibility": {
    "version": "1.0.0",
    "backward_compatible": true,
    "breaking_changes": "Command argument validation, timeout behavior",
    "migration_guide": "Update scripts to handle new validation rules and timeout defaults"
  }
}